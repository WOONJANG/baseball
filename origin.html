<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ë¹„ ìœ„ì¹˜ ì •í•˜ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            text-align: center;
        }
        h2 {
            text-align: center;
        }
        .input-section {
            margin-bottom: 20px;
        }
        .input-section input {
            padding: 5px;
            width: 80%;
        }
        .input-section button {
            padding: 5px;
            background-color: green;
            color: white;
            border: none;
            cursor: pointer;
        }
        .player {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .player input, .player select {
            padding: 5px;
            margin-right: 5px;
        }

	.pref1, .pref2, .pref3 {
	    width: 100px;
	}
	.name {
	    width: 250px;
	}
        button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            width: 100%;
            margin-bottom: 10px;
	    border-radius: 20px;
        }
        .remove-btn {
            background-color: red;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .result {
            margin-top: 20px;
        }
	footer{
		margin-bottom: 10px;
		margin: 0 auto;
	}
	a {
    		text-decoration: none;
	}
	button:hover, .remove-btn:hover {
    		background-color: darkgreen; /* or a different contrasting color */
	}
	#label-container div {
    		display: flex;
    		justify-content: space-between;
    		margin-bottom: 10px;
	}

	#label-container span {
    		width: 250px; /* ì´ë¦„ ì¹¸ê³¼ ë™ì¼í•œ ë„“ì´ */
    		text-align: center;
		font-weight: bold;
	}
		
	#label-container span:nth-child(2),
	#label-container span:nth-child(3),
	#label-container span:nth-child(4) {
    		width: 100px; /* ì§€ë§ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì™€ ë™ì¼í•œ ë„“ì´ */
	}

        @media (min-width: 600px) {
    		body {
        		max-width: 600px;
        		margin: 0 auto;
        		padding: 10px; /* ì¶”ê°€ */
    		}
	}

    </style>
</head>
<body>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTO LINEUP</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<h1>Auto LineUp</h1>

<div class="input-section">
    <input type="text" id="name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„">
    <button id="save-names" style="width:98px;">ğŸ“</button>
</div>

<div id="label-container">
    <div>
        <span>ì´ë¦„</span>
        <span>1ì§€ë§</span>
        <span>2ì§€ë§</span>
        <span>3ì§€ë§</span>
    </div>
</div>
<div id="player-container"></div>


<button id="remove-player" style="display:none;"> â§¿ </button>
<button id="add-player">â§¾</button>

<button id="create-lineup" style="display:none;">âœ”</button>

<div id="results"></div>
    
<a id="link" href="https://github.com/WOONJANG" onclick="return false;"><footer style="color: black;">Â© 2024. ì¥ìš´ All rights reserved.</footer></a>
<script src="js/script_ori.js"></script>
</body>
</html>

<script>
    let playerCount = 0;
    const positions = ["íˆ¬ìˆ˜", "í¬ìˆ˜", "1ë£¨ìˆ˜", "2ë£¨ìˆ˜", "3ë£¨ìˆ˜", "ìœ ê²©ìˆ˜", "ì¢Œìµìˆ˜", "ì¤‘ê²¬ìˆ˜", "ìš°ìµìˆ˜", "ì§€ëª…íƒ€ì"];
    let savedNames = [];

    // ì´ë¦„ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    function saveNames() {
        const input = document.getElementById("name-input").value;
        if (input.trim() === '') return;

        savedNames = input.split(',').map(name => name.trim());

        // ì¿ í‚¤ì— ì €ì¥
        document.cookie = `savedNames=${savedNames.join(',')}; path=/`;
        alert("ì´ë¦„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // ì¿ í‚¤ì—ì„œ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadNamesFromCookies() {
        const cookieValue = document.cookie.split('; ').find(row => row.startsWith('savedNames='));
        if (cookieValue) {
            savedNames = cookieValue.split('=')[1].split(',');
        }
    }

    function addPlayer() {
        if (playerCount >= 20) return;

        const container = document.createElement("div");
        container.classList.add("player");

        container.innerHTML = `
            <select class="name">${generateNameOptions()}</select>
            <select class="pref1">${generateOptions()}</select>
            <select class="pref2">${generateOptions()}</select>
            <select class="pref3">${generateOptions()}</select>
        `;

        document.getElementById("player-container").appendChild(container);
        playerCount++;

        updateRemoveButtonVisibility();

        if (playerCount >= 9) {
            document.getElementById("create-lineup").style.display = 'block';
            document.getElementById("create-lineup").style.backgroundColor = 'green';
        } else {
            document.getElementById("create-lineup").style.display = 'none';
        }
    }

    // ë“œë¡­ë‹¤ìš´ì— ì €ì¥ëœ ì´ë¦„ë“¤ í‘œì‹œ
    function generateNameOptions() {
        return savedNames.map(name => `<option value="${name}">${name}</option>`).join('');
    }

    function generateOptions() {
        return positions.map(pos => `<option value="${pos}">${pos}</option>`).join('');
    }

    function createLineup() {
        const players = Array.from(document.querySelectorAll(".player")).map(player => ({
            name: player.querySelector(".name").value,
            pref1: player.querySelector(".pref1").value,
            pref2: player.querySelector(".pref2").value,
            pref3: player.querySelector(".pref3").value
        }));

        const resultsContainer = document.getElementById("results");
        resultsContainer.innerHTML = ''; // ê²°ê³¼ë¥¼ ìƒˆë¡œ ì´ˆê¸°í™”

        // ê° ì•ˆì— ëŒ€í•œ ê²°ê³¼ ìƒì„±
        const result = document.createElement("div");
        result.classList.add("result");
        result.innerHTML = `<h2>LineUp</h2>${generateTable(players)}`;
        resultsContainer.appendChild(result);
    }

function generateTable(players) {
    const positionAssignments = {
        "íˆ¬ìˆ˜": [],
        "í¬ìˆ˜": [],
        "1ë£¨ìˆ˜": [],
        "2ë£¨ìˆ˜": [],
        "3ë£¨ìˆ˜": [],
        "ìœ ê²©ìˆ˜": [],
        "ì¢Œìµìˆ˜": [],
        "ì¤‘ê²¬ìˆ˜": [],
        "ìš°ìµìˆ˜": [],
        "ì§€ëª…íƒ€ì": [],
        "ëŒ€ê¸°ì¸ì›": []
    };

    const assignedPlayers = new Set(); // ì´ë¯¸ ë°°ì •ëœ ì„ ìˆ˜ë“¤
    const addedPlayers = new Set(); // ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ì²´í¬í•˜ëŠ” Set

    // 1ì§€ë§ ë°°ì¹˜
    const firstPrefs = {};
    players.forEach(player => {
        const pref1 = player.pref1;
        if (!firstPrefs[pref1]) firstPrefs[pref1] = [];
        firstPrefs[pref1].push(player);
    });

    for (const [pos, playersWithSamePref] of Object.entries(firstPrefs)) {
        if (playersWithSamePref.length > 0 && positionAssignments[pos].length === 0) {
            const randomIndex = Math.floor(Math.random() * playersWithSamePref.length);
            positionAssignments[pos].push(playersWithSamePref[randomIndex]);
            assignedPlayers.add(playersWithSamePref[randomIndex].name);
        }
    }

    // 2ì§€ë§ ë°°ì¹˜
    players.forEach(player => {
        if (!assignedPlayers.has(player.name)) {
            const pref2 = player.pref2;
            if (positionAssignments[pref2].length === 0) {
                positionAssignments[pref2].push(player);
                assignedPlayers.add(player.name);
            }
        }
    });

    // 3ì§€ë§ ë°°ì¹˜
    players.forEach(player => {
        if (!assignedPlayers.has(player.name)) {
            const pref3 = player.pref3;
            if (positionAssignments[pref3].length === 0) {
                positionAssignments[pref3].push(player);
                assignedPlayers.add(player.name);
            }
        }
    });

    // ëŒ€ê¸°ì¸ì› ì²˜ë¦¬
    players.forEach(player => {
        if (!assignedPlayers.has(player.name)) {
            positionAssignments["ëŒ€ê¸°ì¸ì›"].push(player);
        }
    });

    // ì§€ëª…íƒ€ì ëœë¤ ë°°ì¹˜
    const availableForDH = players.filter(p => !assignedPlayers.has(p.name) && p.pref1 === "ì§€ëª…íƒ€ì");
    if (availableForDH.length === 0 && assignedPlayers.size > 0) {
        const firstDH = positionAssignments["ëŒ€ê¸°ì¸ì›"][0] || positionAssignments["íˆ¬ìˆ˜"][0];
        if (firstDH) {
            positionAssignments["ì§€ëª…íƒ€ì"].push(firstDH);
            assignedPlayers.add(firstDH.name);
        }
    } else if (availableForDH.length > 0) {
        const randomIndex = Math.floor(Math.random() * availableForDH.length);
        positionAssignments["ì§€ëª…íƒ€ì"].push(availableForDH[randomIndex]);
        assignedPlayers.add(positionAssignments["ì§€ëª…íƒ€ì"][0].name);
    }

    // ì§€ëª…íƒ€ìì— ì—¬ëŸ¬ ëª…ì´ ìˆëŠ” ê²½ìš° ì²˜ë¦¬
    if (positionAssignments["ì§€ëª…íƒ€ì"].length > 1) {
        const firstDH = positionAssignments["ì§€ëª…íƒ€ì"].shift(); // ì²« ë²ˆì§¸ ì„ ìˆ˜ë§Œ ë‚¨ê¹€
        const remainingDH = positionAssignments["ì§€ëª…íƒ€ì"].map(p => p.name).join(', ');
        positionAssignments["ëŒ€ê¸°ì¸ì›"].push({ name: remainingDH });
        positionAssignments["ì§€ëª…íƒ€ì"] = [firstDH];
    }

    // ì¤‘ë³µëœ ì´ë¦„ ì œê±°
    for (const [pos, players] of Object.entries(positionAssignments)) {
        positionAssignments[pos] = players.filter(player => {
            if (!addedPlayers.has(player.name)) {
                addedPlayers.add(player.name); // ì´ë¦„ì´ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ìœ¼ë©´ ì¶”ê°€
                return true;
            }
            return false;
        });
    }

    // ì¤‘ë³µëœ ì´ë¦„ì„ ëŒ€ê¸°ì¸ì›ì—ì„œ ì œê±°
    const uniqueWaitingPlayers = new Set();
    positionAssignments["ëŒ€ê¸°ì¸ì›"] = positionAssignments["ëŒ€ê¸°ì¸ì›"].filter(player => {
        if (!uniqueWaitingPlayers.has(player.name)) {
            uniqueWaitingPlayers.add(player.name); // ì¤‘ë³µëœ ì´ë¦„ì€ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
            return true;
        }
        return false;
    });

    // í…Œì´ë¸” ìƒì„±
    let table = `
        <table>
            <tr>
                <th>í¬ì§€ì…˜</th>
                <th>ì„ ìˆ˜</th>
            </tr>
            ${Object.entries(positionAssignments).map(([pos, players]) => `
                <tr>
                    <td>${pos}</td>
                    <td>${pos === "ì§€ëª…íƒ€ì" ? 
                        (players.length > 0 ? players[0].name : '') : 
                        (players.length > 0 ? players.map(p => p.name).join(', ') : '')}</td>
                </tr>
            `).join('')}
        </table>
    `;

    return table;
}

    function updateRemoveButtonVisibility() {
        const removeButton = document.getElementById("remove-player");
	removeButton.style.backgroundColor = 'red';
        removeButton.style.display = playerCount > 1 ? 'block' : 'none';
    }

    document.getElementById("save-names").addEventListener("click", saveNames);
    document.getElementById("add-player").addEventListener("click", addPlayer);
    document.getElementById("create-lineup").addEventListener("click", createLineup);
    document.getElementById("remove-player").addEventListener("click", function() {
        const playerContainers = document.querySelectorAll(".player");
        if (playerContainers.length > 0) {
            playerContainers[playerContainers.length - 1].remove();
            playerCount--;
            updateRemoveButtonVisibility();
        }
        if (playerCount <= 8) {
            document.getElementById("create-lineup").style.display = 'none';
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿ í‚¤ì—ì„œ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸°
    loadNamesFromCookies();

function getRandomColor() {
	const letters = '0123456789ABCDEF';
    	let color = '#';
    	for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
	}
   		 return color;
}

        let clickCount = 0;
        const linkElement = document.getElementById('link');

        linkElement.addEventListener('click', function(event) {
            clickCount++;
            if (clickCount === 10) {
                // Change background color randomly
                document.body.style.backgroundColor = getRandomColor();
            } else if (clickCount === 14) {
                // Activate link and navigate to the URL
                linkElement.setAttribute('href', 'https://github.com/WOONJANG');
                linkElement.removeAttribute('onclick');
            }
        });
</script>
</body>
</html>
